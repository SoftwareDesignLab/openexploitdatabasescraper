from selenium import webdriver
from selenium.webdriver.firefox.options import Options as FirefoxOptions
from bs4 import BeautifulSoup
from selenium.common.exceptions import NoSuchElementException

def create_firefox_browser():
    """
    Creates a Firefox Selenium instance and logs in using the credentials file passed in (or asks for it).
    :param credentials_file: Location of credentials file
    :return: Firefox browser instance (headless)
    """
    # set headless mode
    ff_options = FirefoxOptions()
    ff_options.add_argument("--headless")
    ff_options.set_preference("javascript.enabled", True)

    # create the browser instance
    browser = webdriver.Firefox(ff_options)

    #** Sample code to test the browser **#
    """
    # basic authentication
    browser.get('https://www.commcarehq.org/accounts/login/')

    # find the login form fields (username, password, and submit button)
    username_field = browser.find_element_by_id('id_auth-username')
    password_field = browser.find_element_by_id('id_auth-password')
    submit_button = browser.find_element_by_css_selector('.btn.btn-primary.btn-lg')

    # fill out the username and password
    username_field.send_keys(username)
    password_field.send_keys(password)

    # submit the login form
    submit_button.click()

    # confirm we're authenticated
    if 'My Projects' not in browser.title:
        raise ValueError('Authentication failed.  Please check credentials.')
    """
    
    return browser