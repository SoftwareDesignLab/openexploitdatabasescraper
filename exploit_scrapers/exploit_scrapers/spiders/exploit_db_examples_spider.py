import scrapy
from pathlib import Path
from open_exploit_database_scraping.exploit.models import Exploit

class ExamplesSpider(scrapy.Spider):
    """This spider is ment to be employed by the 'exploit_db_csv' spider to scrape the raw example exploit files."""
    name = "examples"

    def __init__(self, url):
        """When this spider is created we must hand in the url to scrape."""
        super(ExamplesSpider, self)
        self.start_urls = [url,]

    def parse(self, response):
        # The name of the file is at the end of the split
        exploit_file = self.start_urls[0].split('/')[-1]
        filename = f"exploits/" + exploit_file
        Path(filename).write_bytes(response.body)