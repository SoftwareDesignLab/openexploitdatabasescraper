from open_exploit_database_scraping.exploit.models import Exploit
from django.core.files.base import ContentFile

def save_exploit(source, name, is_repo, source_url=None, cve_id=None, date_published=None, author=None, description=None, download_failed=False, file_name=None, file_content=None):
    """Function takes in the parameters needed to create and save an exploit mode. Will not save duplicates.

    :param source: The source name of this exploit. Ex.: GitHub, CXSecurity, ...
    :type source: str
    :param name: The name of the exploit.
    :type name: str
    :param is_repo: Boolean field indicating if the exploit is a repo archive file.
    :type is_repo: bool
    :param source_url: The URL of the exploit.
    :type source_url: str
    :param cve_id: The CVE ID of the exploit.
    :type cve_id: str
    :param date_published: The datetime object of when the the exploit was published or uploaded, defaults to None.
    :type date_published: datetime.datetimem, optional
    :param author: The author or uploader of the exploit, defaults to None.
    :type author: str, optional
    :param description: A short description of the exploit, defaults to None.
    :type description: str, optional
    :param download_failed: Boolean value indicating if a failure to download the example exploit file occured, defaults to False.
    :type download_failed: bool, optional
    :param file_name: The name of the file, defaults to None.
    :type file_name: str, optional
    :param file_content: The content to be in the file.
    :type file_content: str, optional
    """
    exploit, is_created = Exploit.objects.get_or_create(
        source=source, name=name, source_url=source_url, cve_id=cve_id, date_published=date_published, author=author, description=description, is_repo=is_repo, download_failed=download_failed
        )
    if is_created:
        # If we created a new model ...
        if file_name is not None:
            # If we have a file to save, save it
            exploit.example_file.save(file_name.replace('/', '_'), ContentFile(file_content))
        # Save model.
        exploit.save()