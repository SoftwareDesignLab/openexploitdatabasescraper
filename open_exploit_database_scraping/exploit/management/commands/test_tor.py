from django.core.management.base import BaseCommand
import socket
from open_exploit_database_scraping.utils.tor_requests import RequestsTor

class Command(BaseCommand):
    help = "Test the Tor network."

    def handle(self, *args, **kwargs):
        runs = 20
        tor_service_ip = socket.gethostbyname('tor')
        rt = RequestsTor(tor_ports=(9050,), tor_cport=9051, host=tor_service_ip, autochange_id=5, password='5Z8Rigji8ymruhQOsjAs')

        url = 'https://check.torproject.org/api/ip'

        for i in range(runs):
            r = rt.get(url)
            print(r.text)

