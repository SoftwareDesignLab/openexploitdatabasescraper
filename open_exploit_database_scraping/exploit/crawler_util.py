from scrapy.crawler import Crawler
from twisted.internet import reactor
from billiard import Process
from scrapy.utils.project import get_project_settings
from scrapy import signals


class UrlCrawlerScript(Process):
    def __init__(self, spider, n_days=None):
        Process.__init__(self)
        # settings = get_project_settings()
        self.crawler = Crawler()
        self.crawler.configure()
        self.crawler.signals.connect(reactor.stop, signal=signals.spider_closed)
        self.spider = spider
        self.n_days = n_days

    def run(self):
        self.crawler.crawl(self.spider, self.n_days)
        self.crawler.start()
        reactor.run()