from scrapy.crawler import CrawlerProcess
from twisted.internet import reactor
from django_cog import cog
import time

@cog
def sample_task():
    print("Hello World!")

@cog
def five_seconds():
    print("pausing 5 seconds...")
    time.sleep(5)
    print("\t...5 seconds up!")

@cog
def crawl_cxsecurity(n_days=None):
    from exploit_scrapers.exploit_scrapers.spiders import cxsecurity_spider
    # Init a crawler process for spiders.
    process = CrawlerProcess()
    # Scrapers go here.
    print("\n[INFO] Crawling CXSecurity...")
    process.crawl(cxsecurity_spider.CXSecuritySpider, n_days)
    print("\n[INFO] Done")
    process.start()
    reactor.stop()

@cog
def crawl_exploit_db(n_days=None):
    from exploit_scrapers.exploit_scrapers.spiders import exploit_db_csv_spider
    # Init a crawler process for spiders.
    process = CrawlerProcess()
    # Scrapers go here.
    print("\n[INFO] Crawling ExploitDB's Gitlab...")
    process.crawl(exploit_db_csv_spider.CSVSpider, n_days)
    print("\n[INFO] Done")
    process.start()
    reactor.stop()

@cog
def crawl_packetstorm(n_days=None):
    from exploit_scrapers.exploit_scrapers.spiders import packetstorm_spider
    # Init a crawler process for spiders.
    process = CrawlerProcess()
    # Scrapers go here.
    print("\n[INFO] Crawling Packetstorm...")
    process.crawl(packetstorm_spider.PacketStormSpider, n_days)
    print("\n[INFO] Done")
    process.start()
    reactor.stop()
