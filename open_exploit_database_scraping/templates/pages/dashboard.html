{% include 'base.html' %}
{% load static %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
<br>
<h1 style="padding-left: 30px;">Open Exploit Dashboard</h1>

<!-- Bootstrap Alert -->
{% if download_failures != 0 %}
<div class="container-fluid" style="padding-left: 30px;">
  <div class="row">
      <div class="col-md-10 col-md-offset-1">
          <div class="alert alert-warning alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-circle" style="font-size: 24px;"></i> <a class="alert-link" href="{{request.path}}admin/exploit/exploit/?download_failed__exact=1">{{download_failures}} error(s)</a> identified
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="margin-top: 7px;"></button>
          </div>
      </div>
    </div>
</div>
{% endif %}

<br>

<div class="row" style="padding-left: 30px; padding-right: 30px">
    <!-- Card 1 -->
    <div class="col-sm-4">
        <div class="card border-start-lg border-start-primary">
        <div class="card-body">
          <div class="card-header text-primary mb-3">Exploits Added in the Last 24 Hours</div>
          <h4 > <b>{{24_hours}}</b> </h4>
        </div>
      </div>
    </div>
    <!-- Card 2 -->
    <div class="col-sm-4">
      <div class="card border-start-lg border-start-danger">
        <div class="card-body">
          <div class="card-header text-danger mb-3">Exploits Added in the Last 7 Days</div>
          <h4 > <b>{{7_days}}</b></h4>
        </div>
      </div>
    </div>
    <!-- Card 3 -->
    <div class="col-sm-4">
        <div class="card border-start-lg border-start-success">
          <div class="card-body">
            <div class="card-header text-success mb-3">Total Exploits Collected  </div>
            <h4><b> {{exploits_count}}</b></h4>
          </div>
        </div>
      </div>
  </div>
  <br>

    <div class="row"  style="padding-left: 20px; padding-right: 20px; padding-top: 20px;">
      <div class="col-sm-8" style="padding-right: .8rem">
        <figure class="highcharts-figure">
            <div id="container">
            </div>
    </figure>
      </div>

<!-- Card 4 -->
<div class="col-sm-4">
    <div class="card border-start-lg border-start-success">
      <div class="card-body">
        <h5 class="card-header text-success mb-3">Breakdown by Source
        </h5>
        <table class="table table-striped">
          <thead>
            <tr>
                <th>Source</th>
                <th>Count</th>
                <th> Percentage</th>
                <th > &emsp; &emsp; &emsp;  &emsp; </th>
            </tr>
          </thead>
          <tbody>
            {% for source in sources %}
            <tr>
            <td>{{source.source}}</td>
            <td> {{source.count}}</td>
            <td> {{source.percentage}} %</td>
            <td>
            <div class="progress" role="progressbar" aria-label="Example 1px high" aria-valuenow="{{source.percentage}}" aria-valuemin="0" aria-valuemax="100" style="height: 3px">
                <div class="{{source.color}}" style="width: {{source.percentage}}%"></div>
            </div>
            </td>
            </tr>
            {% endfor %}
            </tbody>
            </table>
      </div>
    </div>
  </div>
</div>


<!-- Highchart -->
  <script>

Highcharts.chart('container', {
  chart: {
        type: 'spline',
        scrollablePlotArea: {
            minWidth: 700,
            scrollPositionX: 1
        }
    },
    title: {
        text: 'Exploits Added by Month in {{year}}',
        align: 'left',
    },

    data: {
        dateFormat: 'mm/dd/YYYY'
    },
    plotOptions: {
        series: {
            marker: {
                enabled: false
            },
            lineWidth: 2
        }
    },
    xAxis: {
        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
            'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        accessibility: {
            description: 'Months of the year'
        },
        overflow: 'justify'
    },
    yAxis: {
      title:{
        text: 'Exploits Added'
      }
    },  
    series:{{data|safe}}
  
});

  </script>